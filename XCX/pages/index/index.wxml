<!--index.wxml-->
<view class="container">
  <!-- é¡¶éƒ¨æ¬¢è¿åŒºåŸŸ -->
  <view class="welcome-section">
    <view class="welcome-header">
      <view class="welcome-info">
        <view class="welcome-title">ä½ å¥½ï¼Œ{{userName}}</view>
        <view class="welcome-subtitle">{{currentDate}}</view>
      </view>
      <view class="user-avatar" bindtap="openProfile">
        <image class="avatar-img" src="{{userAvatar}}" mode="aspectFill" />
        <view class="avatar-status"></view>
      </view>
    </view>
    
    <view class="weather-info" wx:if="{{weather.show}}">
      <view class="weather-icon">{{weather.icon}}</view>
      <view class="weather-text">
        <view class="weather-temp">{{weather.temperature}}Â°C</view>
        <view class="weather-desc">{{weather.description}}</view>
      </view>
      <view class="weather-location">{{weather.location}}</view>
    </view>
  </view>

  <!-- å¿«é€Ÿç»Ÿè®¡ -->
  <view class="stats-section">
    <view class="stats-grid">
      <view class="stat-item" bindtap="navigateToTodo">
        <view class="stat-icon todo">ğŸ“‹</view>
        <view class="stat-info">
          <view class="stat-number">{{stats.pendingTodos}}</view>
          <view class="stat-label">å¾…åŠäº‹é¡¹</view>
        </view>
        <view class="stat-trend {{stats.todoTrend >= 0 ? 'up' : 'down'}}">
          {{stats.todoTrend >= 0 ? 'â†—' : 'â†˜'}}
        </view>
      </view>
      
      <view class="stat-item" bindtap="navigateToDocs">
        <view class="stat-icon doc">ğŸ“„</view>
        <view class="stat-info">
          <view class="stat-number">{{stats.recentDocs}}</view>
          <view class="stat-label">æœ€è¿‘æ–‡æ¡£</view>
        </view>
        <view class="stat-trend {{stats.docTrend >= 0 ? 'up' : 'down'}}">
          {{stats.docTrend >= 0 ? 'â†—' : 'â†˜'}}
        </view>
      </view>
      
      <view class="stat-item" bindtap="navigateToMeeting">
        <view class="stat-icon meeting">ğŸ¯</view>
        <view class="stat-info">
          <view class="stat-number">{{stats.todayMeetings}}</view>
          <view class="stat-label">ä»Šæ—¥ä¼šè®®</view>
        </view>
        <view class="stat-trend {{stats.meetingTrend >= 0 ? 'up' : 'down'}}">
          {{stats.meetingTrend >= 0 ? 'â†—' : 'â†˜'}}
        </view>
      </view>
      
      <view class="stat-item" bindtap="navigateToContacts">
        <view class="stat-icon contact">ğŸ‘¥</view>
        <view class="stat-info">
          <view class="stat-number">{{stats.totalContacts}}</view>
          <view class="stat-label">è”ç³»äºº</view>
        </view>
        <view class="stat-trend {{stats.contactTrend >= 0 ? 'up' : 'down'}}">
          {{stats.contactTrend >= 0 ? 'â†—' : 'â†˜'}}
        </view>
      </view>
    </view>
  </view>

  <!-- å¿«é€Ÿæ“ä½œ -->
  <view class="quick-actions">
    <view class="section-header">
      <view class="section-title">å¿«é€Ÿæ“ä½œ</view>
    </view>
    
    <view class="actions-grid">
      <!-- æ–°å¢ï¼šæ‰«ç æŸ¥è¯¢ -->
      <view class="action-item" bindtap="quickScanQuery">
        <view class="action-icon">ğŸ”</view>
        <view class="action-label">æ‰«ç æŸ¥è¯¢</view>
      </view>

      <!-- æ–°å¢ï¼šç¼–ç æŸ¥è¯¢ -->
      <view class="action-item" bindtap="quickCodeQuery">
        <view class="action-icon">âŒ¨ï¸</view>
        <view class="action-label">ç¼–ç æŸ¥è¯¢</view>
      </view>
      <view class="action-item" bindtap="quickAddTodo">
        <view class="action-icon">â•</view>
        <view class="action-label">æ·»åŠ å¾…åŠ</view>
      </view>
      
      <view class="action-item" bindtap="quickCreateDoc">
        <view class="action-icon">ğŸ“</view>
        <view class="action-label">æ–°å»ºæ–‡æ¡£</view>
      </view>
      
      <view class="action-item" bindtap="quickScheduleMeeting">
        <view class="action-icon">ğŸ“…</view>
        <view class="action-label">å®‰æ’ä¼šè®®</view>
      </view>
      
      <view class="action-item" bindtap="quickAddContact">
        <view class="action-icon">ğŸ‘¤</view>
        <view class="action-label">æ·»åŠ è”ç³»äºº</view>
      </view>
      
      <!-- åŸæœ‰æ‰«ç å…¥å£ä¿ç•™ï¼Œå¯ç”¨äºå…¶ä»–ä¸šåŠ¡ -->
      <view class="action-item" bindtap="quickScan">
        <view class="action-icon">ğŸ“·</view>
        <view class="action-label">æ‰«ç </view>
      </view>
      
      <view class="action-item" bindtap="quickVoice">
        <view class="action-icon">ğŸ¤</view>
        <view class="action-label">è¯­éŸ³è¾“å…¥</view>
      </view>

    </view>
  </view>

  <!-- ä»Šæ—¥æ—¥ç¨‹ -->
  <view class="schedule-section">
    <view class="section-header">
      <view class="section-title">ä»Šæ—¥æ—¥ç¨‹</view>
      <view class="section-more" bindtap="viewAllSchedule">æŸ¥çœ‹å…¨éƒ¨</view>
    </view>
    
    <view class="schedule-list" wx:if="{{schedule.length > 0}}">
      <view 
        class="schedule-item {{item.type}}"
        wx:for="{{schedule}}"
        wx:key="id"
        bindtap="openScheduleItem"
        data-item="{{item}}"
      >
        <view class="schedule-time">
          <view class="time-text">{{item.timeText}}</view>
          <view class="time-dot"></view>
        </view>
        <view class="schedule-content">
          <view class="schedule-title">{{item.title}}</view>
          <view class="schedule-desc" wx:if="{{item.description}}">{{item.description}}</view>
          <view class="schedule-meta">
            <view class="schedule-type">{{item.typeText}}</view>
            <view class="schedule-status {{item.status}}">{{item.statusText}}</view>
          </view>
        </view>
        <view class="schedule-action">
          <view class="action-btn" wx:if="{{item.canStart}}" bindtap="startScheduleItem" data-item="{{item}}">
            å¼€å§‹
          </view>
        </view>
      </view>
    </view>
    
    <!-- ç©ºçŠ¶æ€ -->
    <view class="empty-schedule" wx:else>
      <view class="empty-icon">ğŸ“…</view>
      <view class="empty-text">ä»Šå¤©æš‚æ— æ—¥ç¨‹å®‰æ’</view>
      <view class="empty-action" bindtap="quickScheduleMeeting">å®‰æ’ç¬¬ä¸€ä¸ªä¼šè®®</view>
    </view>
  </view>

  <!-- æœ€è¿‘æ´»åŠ¨ -->
  <view class="activity-section">
    <view class="section-header">
      <view class="section-title">æœ€è¿‘æ´»åŠ¨</view>
      <view class="section-more" bindtap="viewAllActivity">æŸ¥çœ‹å…¨éƒ¨</view>
    </view>
    
    <view class="activity-list">
      <view 
        class="activity-item"
        wx:for="{{recentActivity}}"
        wx:key="id"
        bindtap="openActivityItem"
        data-item="{{item}}"
      >
        <view class="activity-icon {{item.type}}">
          {{item.icon}}
        </view>
        <view class="activity-content">
          <view class="activity-title">{{item.title}}</view>
          <view class="activity-desc">{{item.description}}</view>
          <view class="activity-time">{{item.timeText}}</view>
        </view>
        <view class="activity-status {{item.status}}">
          {{item.statusText}}
        </view>
      </view>
    </view>
  </view>

  <!-- æ¨èåŠŸèƒ½ -->
  <view class="recommendations-section" wx:if="{{recommendations.length > 0}}">
    <view class="section-header">
      <view class="section-title">ä¸ºä½ æ¨è</view>
    </view>
    
    <scroll-view class="recommendations-scroll" scroll-x>
      <view class="recommendations-list">
        <view 
          class="recommendation-item"
          wx:for="{{recommendations}}"
          wx:key="id"
          bindtap="openRecommendation"
          data-item="{{item}}"
        >
          <view class="recommendation-image">
            <image src="{{item.image}}" mode="aspectFill" />
          </view>
          <view class="recommendation-content">
            <view class="recommendation-title">{{item.title}}</view>
            <view class="recommendation-desc">{{item.description}}</view>
            <view class="recommendation-tag">{{item.tag}}</view>
          </view>
        </view>
      </view>
    </scroll-view>
  </view>

  <!-- æœç´¢å…¥å£ -->
  <view class="search-section">
    <view class="search-bar" bindtap="openSearch">
      <view class="search-icon">ğŸ”</view>
      <view class="search-placeholder">æœç´¢å¾…åŠã€æ–‡æ¡£ã€è”ç³»äºº...</view>
      <view class="search-voice" bindtap="voiceSearch">
        <view class="voice-icon">ğŸ¤</view>
      </view>
    </view>
  </view>

  <!-- å¿«é€Ÿæ·»åŠ å¾…åŠå¼¹çª— -->
  <view class="modal-overlay" wx:if="{{showQuickTodo}}" bindtap="hideQuickTodo">
    <view class="modal-content quick-todo-modal" catchtap="stopPropagation">
      <view class="modal-header">
        <view class="modal-title">å¿«é€Ÿæ·»åŠ å¾…åŠ</view>
        <view class="modal-close" bindtap="hideQuickTodo">âœ•</view>
      </view>
      
      <view class="modal-body">
        <view class="form-group">
          <input 
            class="form-input" 
            placeholder="è¯·è¾“å…¥å¾…åŠäº‹é¡¹" 
            value="{{quickTodoText}}" 
            bindinput="onQuickTodoInput" 
            confirm-type="done" 
            bindconfirm="saveQuickTodo" 
            focus="{{showQuickTodo}}"
          />
        </view>
        
        <view class="form-group">
          <view class="form-label">ä¼˜å…ˆçº§</view>
          <view class="priority-options">
            <view 
              class="priority-option {{quickTodoPriority === 'low' ? 'active' : ''}}"
              bindtap="selectQuickTodoPriority"
              data-priority="low"
            >
              <view class="priority-dot low"></view>
              <view class="priority-text">ä½</view>
            </view>
            <view 
              class="priority-option {{quickTodoPriority === 'medium' ? 'active' : ''}}"
              bindtap="selectQuickTodoPriority"
              data-priority="medium"
            >
              <view class="priority-dot medium"></view>
              <view class="priority-text">ä¸­</view>
            </view>
            <view 
              class="priority-option {{quickTodoPriority === 'high' ? 'active' : ''}}"
              bindtap="selectQuickTodoPriority"
              data-priority="high"
            >
              <view class="priority-dot high"></view>
              <view class="priority-text">é«˜</view>
            </view>
          </view>
        </view>
      </view>
      
      <view class="modal-footer">
        <view class="btn-group">
          <button class="btn btn-cancel" bindtap="hideQuickTodo">å–æ¶ˆ</button>
          <button class="btn btn-primary" bindtap="saveQuickTodo" disabled="{{!quickTodoText}}">ä¿å­˜</button>
        </view>
      </view>
    </view>
  </view>

  <!-- æœç´¢å¼¹çª— -->
  <view class="modal-overlay search-modal" wx:if="{{showSearch}}" bindtap="hideSearch">
    <view class="modal-content" catchtap="stopPropagation">
      <view class="search-header">
        <view class="search-input-wrapper">
          <view class="search-icon">ğŸ”</view>
          <input 
            class="search-input" 
            placeholder="æœç´¢å¾…åŠã€æ–‡æ¡£ã€è”ç³»äºº..." 
            value="{{searchText}}" 
            bindinput="onSearchInput" 
            confirm-type="search" 
            bindconfirm="performSearch"
            focus="{{showSearch}}"
          />
          <view class="search-clear" wx:if="{{searchText}}" bindtap="clearSearch">âœ•</view>
        </view>
        <view class="search-cancel" bindtap="hideSearch">å–æ¶ˆ</view>
      </view>
      
      <view class="search-body">
        <!-- æœç´¢å†å² -->
        <view class="search-history" wx:if="{{!searchText && searchHistory.length > 0}}">
          <view class="history-header">
            <view class="history-title">æœç´¢å†å²</view>
            <view class="history-clear" bindtap="clearSearchHistory">æ¸…ç©º</view>
          </view>
          <view class="history-list">
            <view 
              class="history-item"
              wx:for="{{searchHistory}}"
              wx:key="*this"
              bindtap="selectSearchHistory"
              data-text="{{item}}"
            >
              <view class="history-icon">ğŸ•’</view>
              <view class="history-text">{{item}}</view>
            </view>
          </view>
        </view>
        
        <!-- æœç´¢å»ºè®® -->
        <view class="search-suggestions" wx:if="{{!searchText}}">
          <view class="suggestions-title">çƒ­é—¨æœç´¢</view>
          <view class="suggestions-list">
            <view 
              class="suggestion-item"
              wx:for="{{searchSuggestions}}"
              wx:key="*this"
              bindtap="selectSearchSuggestion"
              data-text="{{item}}"
            >
              {{item}}
            </view>
          </view>
        </view>
        
        <!-- æœç´¢ç»“æœ -->
        <view class="search-results" wx:if="{{searchText}}">
          <view class="results-section" wx:if="{{searchResults.todos.length > 0}}">
            <view class="results-title">å¾…åŠäº‹é¡¹</view>
            <view class="results-list">
              <view 
                class="result-item"
                wx:for="{{searchResults.todos}}"
                wx:key="id"
                bindtap="openSearchResult"
                data-type="todo"
                data-item="{{item}}"
              >
                <view class="result-icon">âœ“</view>
                <view class="result-content">
                  <view class="result-title">{{item.title}}</view>
                  <view class="result-desc">{{item.description}}</view>
                </view>
              </view>
            </view>
          </view>
          
          <view class="results-section" wx:if="{{searchResults.docs.length > 0}}">
            <view class="results-title">æ–‡æ¡£</view>
            <view class="results-list">
              <view 
                class="result-item"
                wx:for="{{searchResults.docs}}"
                wx:key="id"
                bindtap="openSearchResult"
                data-type="doc"
                data-item="{{item}}"
              >
                <view class="result-icon">ğŸ“</view>
                <view class="result-content">
                  <view class="result-title">{{item.title}}</view>
                  <view class="result-desc">{{item.description}}</view>
                </view>
              </view>
            </view>
          </view>
          
          <view class="results-section" wx:if="{{searchResults.contacts.length > 0}}">
            <view class="results-title">è”ç³»äºº</view>
            <view class="results-list">
              <view 
                class="result-item"
                wx:for="{{searchResults.contacts}}"
                wx:key="id"
                bindtap="openSearchResult"
                data-type="contact"
                data-item="{{item}}"
              >
                <view class="result-icon">ğŸ‘¤</view>
                <view class="result-content">
                  <view class="result-title">{{item.name}}</view>
                  <view class="result-desc">{{item.company}}</view>
                </view>
              </view>
            </view>
          </view>
          
          <!-- æ— æœç´¢ç»“æœ -->
          <view class="no-results" wx:if="{{searchText && searchResults.todos.length === 0 && searchResults.docs.length === 0 && searchResults.contacts.length === 0}}">
            <view class="no-results-icon">ğŸ”</view>
            <view class="no-results-text">æœªæ‰¾åˆ°ç›¸å…³å†…å®¹</view>
            <view class="no-results-desc">è¯•è¯•å…¶ä»–å…³é”®è¯</view>
          </view>
        </view>
      </view>
    </view>
  </view>
</view>