<!--pages/docs/docs.wxml-->
<view class="container">
  <!-- é¡¶éƒ¨ç»Ÿè®¡åŒºåŸŸ -->
  <view class="stats-section">
    <view class="stats-grid">
      <view class="stat-item">
        <text class="stat-number">{{stats.total}}</text>
        <text class="stat-label">æ€»æ–‡æ¡£</text>
      </view>
      <view class="stat-item">
        <text class="stat-number">{{stats.recent}}</text>
        <text class="stat-label">æœ€è¿‘ç¼–è¾‘</text>
      </view>
      <view class="stat-item">
        <text class="stat-number">{{stats.shared}}</text>
        <text class="stat-label">å…±äº«æ–‡æ¡£</text>
      </view>
      <view class="stat-item">
        <text class="stat-number">{{stats.favorites}}</text>
        <text class="stat-label">æ”¶è—</text>
      </view>
    </view>
  </view>

  <!-- å¿«é€Ÿæ“ä½œ -->
  <view class="quick-actions">
    <view class="action-item" bindtap="createDocument">
      <view class="action-icon create">ğŸ“</view>
      <text class="action-text">æ–°å»ºæ–‡æ¡£</text>
    </view>
    <view class="action-item" bindtap="importDocument">
      <view class="action-icon import">ğŸ“</view>
      <text class="action-text">å¯¼å…¥æ–‡æ¡£</text>
    </view>
    <view class="action-item" bindtap="scanDocument">
      <view class="action-icon scan">ğŸ“·</view>
      <text class="action-text">æ‰«ææ–‡æ¡£</text>
    </view>
    <view class="action-item" bindtap="showTemplates">
      <view class="action-icon template">ğŸ“‹</view>
      <text class="action-text">æ¨¡æ¿åº“</text>
    </view>
  </view>

  <!-- æœç´¢å’Œç­›é€‰åŒºåŸŸ -->
  <view class="search-section">
    <view class="search-bar">
      <input class="search-input" placeholder="æœç´¢æ–‡æ¡£" value="{{searchText}}" bindinput="onSearchInput" />
      <text class="search-icon">ğŸ”</text>
    </view>
    
    <view class="filter-tabs">
      <view class="filter-tab {{currentFilter === 'all' ? 'active' : ''}}" bindtap="switchFilter" data-filter="all">
        <text>å…¨éƒ¨</text>
      </view>
      <view class="filter-tab {{currentFilter === 'recent' ? 'active' : ''}}" bindtap="switchFilter" data-filter="recent">
        <text>æœ€è¿‘</text>
      </view>
      <view class="filter-tab {{currentFilter === 'shared' ? 'active' : ''}}" bindtap="switchFilter" data-filter="shared">
        <text>å…±äº«</text>
      </view>
      <view class="filter-tab {{currentFilter === 'favorites' ? 'active' : ''}}" bindtap="switchFilter" data-filter="favorites">
        <text>æ”¶è—</text>
      </view>
    </view>
    
    <view class="sort-options">
      <view class="sort-item {{currentSort === 'updatedAt' ? 'active' : ''}}" bindtap="switchSort" data-sort="updatedAt">
        <text>æœ€è¿‘ä¿®æ”¹</text>
      </view>
      <view class="sort-item {{currentSort === 'createdAt' ? 'active' : ''}}" bindtap="switchSort" data-sort="createdAt">
        <text>åˆ›å»ºæ—¶é—´</text>
      </view>
      <view class="sort-item {{currentSort === 'title' ? 'active' : ''}}" bindtap="switchSort" data-sort="title">
        <text>æ ‡é¢˜</text>
      </view>
      <view class="sort-item {{currentSort === 'size' ? 'active' : ''}}" bindtap="switchSort" data-sort="size">
        <text>å¤§å°</text>
      </view>
    </view>
  </view>

  <!-- æ–‡æ¡£åˆ—è¡¨ -->
  <view class="docs-list" wx:if="{{filteredDocs.length > 0}}">
    <view class="doc-item" wx:for="{{filteredDocs}}" wx:key="id" bindtap="openDocument" data-item="{{item}}">
      <!-- æ–‡æ¡£å›¾æ ‡ -->
      <view class="doc-icon {{item.type}}">
        <text class="icon-text">{{item.iconText}}</text>
      </view>
      
      <!-- æ–‡æ¡£ä¿¡æ¯ -->
      <view class="doc-content">
        <text class="doc-title">{{item.title}}</text>
        <text class="doc-desc" wx:if="{{item.description}}">{{item.description}}</text>
        
        <!-- æ ‡ç­¾ -->
        <view class="doc-tags" wx:if="{{item.tags && item.tags.length > 0}}">
          <text class="doc-tag" wx:for="{{item.tags}}" wx:for-item="tag" wx:key="*this">{{tag}}</text>
        </view>
        
        <!-- å…ƒä¿¡æ¯ -->
        <view class="doc-meta">
          <text class="doc-time">{{item.updatedAtText}}</text>
          <text class="doc-size" wx:if="{{item.size}}">{{item.sizeText}}</text>
          <text class="doc-author" wx:if="{{item.author}}">{{item.author}}</text>
        </view>
      </view>
      
      <!-- çŠ¶æ€æŒ‡ç¤ºå™¨ -->
      <view class="doc-status">
        <view class="status-indicator shared" wx:if="{{item.isShared}}">ğŸ”—</view>
        <view class="status-indicator favorite {{item.isFavorite ? 'active' : ''}}" bindtap="toggleFavorite" data-id="{{item.id}}" catchtap="preventBubble">â­</view>
        <view class="status-indicator sync {{item.syncStatus}}" wx:if="{{item.syncStatus}}">{{item.syncIcon}}</view>
      </view>
      
      <!-- æ“ä½œæŒ‰é’® -->
      <view class="doc-actions">
        <view class="action-btn" bindtap="showDocOptions" data-item="{{item}}" catchtap="preventBubble">
          <text class="action-icon">â‹¯</text>
        </view>
      </view>
    </view>
  </view>

  <!-- ç©ºçŠ¶æ€ -->
  <view class="empty-state" wx:else>
    <text class="empty-icon">ğŸ“„</text>
    <text class="empty-text">{{emptyText}}</text>
    <text class="empty-action" bindtap="createDocument" wx:if="{{currentFilter === 'all' || currentFilter === 'recent'}}">åˆ›å»ºç¬¬ä¸€ä¸ªæ–‡æ¡£</text>
  </view>

  <!-- æµ®åŠ¨æ“ä½œæŒ‰é’® -->
  <view class="fab" bindtap="createDocument">
    <text class="fab-icon">+</text>
  </view>

  <!-- æ–‡æ¡£åˆ›å»º/ç¼–è¾‘å¼¹çª— -->
  <view class="modal-overlay" wx:if="{{showDocModal}}" bindtap="hideDocModal">
    <view class="modal-content" catchtap="preventClose">
      <view class="modal-header">
        <text class="modal-title">{{editingDoc.id ? 'ç¼–è¾‘æ–‡æ¡£' : 'åˆ›å»ºæ–‡æ¡£'}}</text>
        <text class="modal-close" bindtap="hideDocModal">âœ•</text>
      </view>
      
      <view class="modal-body">
        <!-- æ ‡é¢˜ -->
        <view class="input-group">
          <text class="input-label">æ ‡é¢˜ <text class="input-required">*</text></text>
          <input class="input" placeholder="è¯·è¾“å…¥æ–‡æ¡£æ ‡é¢˜" value="{{editingDoc.title}}" bindinput="onTitleInput" />
        </view>
        
        <!-- æè¿° -->
        <view class="input-group">
          <text class="input-label">æè¿°</text>
          <textarea class="input textarea" placeholder="è¯·è¾“å…¥æ–‡æ¡£æè¿°" value="{{editingDoc.description}}" bindinput="onDescInput"></textarea>
        </view>
        
        <!-- æ–‡æ¡£ç±»å‹ -->
        <view class="input-group">
          <text class="input-label">æ–‡æ¡£ç±»å‹</text>
          <view class="type-selector">
            <view class="type-option {{editingDoc.type === 'text' ? 'active' : ''}}" bindtap="selectType" data-type="text">
              <text class="type-icon">ğŸ“</text>
              <text>æ–‡æœ¬</text>
            </view>
            <view class="type-option {{editingDoc.type === 'markdown' ? 'active' : ''}}" bindtap="selectType" data-type="markdown">
              <text class="type-icon">ğŸ“‹</text>
              <text>Markdown</text>
            </view>
            <view class="type-option {{editingDoc.type === 'table' ? 'active' : ''}}" bindtap="selectType" data-type="table">
              <text class="type-icon">ğŸ“Š</text>
              <text>è¡¨æ ¼</text>
            </view>
          </view>
        </view>
        
        <!-- æ ‡ç­¾ -->
        <view class="input-group">
          <text class="input-label">æ ‡ç­¾</text>
          <view class="tag-input-container">
            <view class="selected-tags" wx:if="{{editingDoc.tags && editingDoc.tags.length > 0}}">
              <view class="selected-tag" wx:for="{{editingDoc.tags}}" wx:key="*this">
                <text>{{item}}</text>
                <text class="tag-remove" bindtap="removeTag" data-tag="{{item}}">Ã—</text>
              </view>
            </view>
            <view class="tag-input-row">
              <input class="tag-input" placeholder="æ·»åŠ æ ‡ç­¾" value="{{inputTag}}" bindinput="onTagInput" bindconfirm="addTag" />
              <button class="tag-add-btn" bindtap="addTag">æ·»åŠ </button>
            </view>
          </view>
        </view>
        
        <!-- å…±äº«è®¾ç½® -->
        <view class="input-group">
          <view class="switch-row">
            <text class="input-label">å…è®¸å…±äº«</text>
            <switch checked="{{editingDoc.isShared}}" bindchange="onShareChange" />
          </view>
          <view class="share-options" wx:if="{{editingDoc.isShared}}">
            <view class="permission-item">
              <text class="permission-label">æƒé™è®¾ç½®ï¼š</text>
              <picker mode="selector" range="{{permissionOptions}}" value="{{editingDoc.permissionIndex}}" bindchange="onPermissionChange">
                <view class="picker-input">
                  <text class="picker-text">{{permissionOptions[editingDoc.permissionIndex]}}</text>
                  <text class="picker-icon">ğŸ”½</text>
                </view>
              </picker>
            </view>
          </view>
        </view>
      </view>
      
      <view class="modal-footer">
        <button class="btn btn-secondary" bindtap="hideDocModal">å–æ¶ˆ</button>
        <button class="btn btn-primary" bindtap="saveDocument">ä¿å­˜</button>
      </view>
    </view>
  </view>

  <!-- æ–‡æ¡£æ“ä½œå¼¹çª— -->
  <view class="action-sheet" wx:if="{{showDocOptions}}" bindtap="hideDocOptions">
    <view class="action-sheet-content" catchtap="preventClose">
      <view class="action-sheet-header">
        <text class="action-sheet-title">{{selectedDoc.title}}</text>
        <text class="action-sheet-close" bindtap="hideDocOptions">âœ•</text>
      </view>
      <view class="action-list">
        <view class="action-item" bindtap="editDocument">
          <text class="action-icon">âœï¸</text>
          <text class="action-text">ç¼–è¾‘</text>
        </view>
        <view class="action-item" bindtap="duplicateDocument">
          <text class="action-icon">ğŸ“‹</text>
          <text class="action-text">å¤åˆ¶</text>
        </view>
        <view class="action-item" bindtap="shareDocument">
          <text class="action-icon">ğŸ“¤</text>
          <text class="action-text">åˆ†äº«</text>
        </view>
        <view class="action-item" bindtap="exportDocument">
          <text class="action-icon">ğŸ’¾</text>
          <text class="action-text">å¯¼å‡º</text>
        </view>
        <view class="action-item" bindtap="moveToFolder">
          <text class="action-icon">ğŸ“</text>
          <text class="action-text">ç§»åŠ¨åˆ°æ–‡ä»¶å¤¹</text>
        </view>
        <view class="action-item danger" bindtap="deleteDocument">
          <text class="action-icon">ğŸ—‘ï¸</text>
          <text class="action-text">åˆ é™¤</text>
        </view>
      </view>
      <view class="action-cancel" bindtap="hideDocOptions">
        <text>å–æ¶ˆ</text>
      </view>
    </view>
  </view>

  <!-- æ¨¡æ¿é€‰æ‹©å¼¹çª— -->
  <view class="modal-overlay" wx:if="{{showTemplates}}" bindtap="hideTemplates">
    <view class="modal-content" catchtap="preventClose">
      <view class="modal-header">
        <text class="modal-title">é€‰æ‹©æ¨¡æ¿</text>
        <text class="modal-close" bindtap="hideTemplates">âœ•</text>
      </view>
      
      <view class="modal-body">
        <view class="template-grid">
          <view class="template-item" wx:for="{{templates}}" wx:key="id" bindtap="createFromTemplate" data-template="{{item}}">
            <view class="template-icon {{item.type}}">
              <text>{{item.icon}}</text>
            </view>
            <text class="template-title">{{item.title}}</text>
            <text class="template-desc">{{item.description}}</text>
          </view>
        </view>
      </view>
      
      <view class="modal-footer">
        <button class="btn btn-secondary" bindtap="hideTemplates">å–æ¶ˆ</button>
      </view>
    </view>
  </view>

  <!-- æ–‡æ¡£ç¼–è¾‘å™¨å¼¹çª— -->
  <view class="modal-overlay editor-modal" wx:if="{{showEditor}}" bindtap="hideEditor">
    <view class="editor-content" catchtap="preventClose">
      <view class="editor-header">
        <view class="editor-title-section">
          <text class="editor-title">{{currentDoc.title}}</text>
          <view class="editor-status">
            <text class="save-status {{currentDoc.saveStatus}}">{{currentDoc.saveStatusText}}</text>
            <text class="sync-time" wx:if="{{collaborativeData.isCollaborativeMode}}">æœ€ååŒæ­¥: {{collaborativeData.lastSyncTime}}</text>
          </view>
        </view>
        <view class="editor-actions">
          <text class="editor-action" bindtap="toggleCollaborativeMode" title="{{collaborativeData.isCollaborativeMode ? 'å…³é—­ååŒç¼–è¾‘' : 'å¼€å¯ååŒç¼–è¾‘'}}">
            {{collaborativeData.isCollaborativeMode ? 'ğŸ”—' : 'ğŸ”’'}}
          </text>
          <text class="editor-action" bindtap="viewEditHistory" title="ç¼–è¾‘å†å²">ğŸ“‹</text>
          <text class="editor-action" bindtap="inviteCollaborator" title="é‚€è¯·åä½œè€…">ğŸ‘¥</text>
          <text class="editor-action" bindtap="saveCurrentDoc" title="ä¿å­˜">ğŸ’¾</text>
          <text class="editor-action" bindtap="hideEditor" title="å…³é—­">âœ•</text>
        </view>
      </view>
      
      <!-- ååŒç¼–è¾‘å·¥å…·æ  -->
      <view class="collaborative-toolbar" wx:if="{{collaborativeData.isCollaborativeMode}}">
        <view class="online-users">
          <text class="toolbar-label">åœ¨çº¿ç”¨æˆ·:</text>
          <view class="user-avatars">
            <view class="user-avatar {{user.isCurrentUser ? 'current-user' : ''}}" wx:for="{{collaborativeData.onlineUsers}}" wx:key="id" wx:for-item="user">
              <image class="avatar-img" src="{{user.avatar}}" mode="aspectFill"></image>
              <text class="user-name">{{user.name}}</text>
            </view>
          </view>
        </view>
        <view class="collaborative-status">
          <text class="status-indicator online">â—</text>
          <text class="status-text">ååŒç¼–è¾‘å·²å¼€å¯</text>
        </view>
      </view>
      
      <view class="editor-body">
        <view wx:if="{{currentDoc.type === 'excel' || currentDoc.type === 'table'}}" class="table-viewer">
          <view class="table-header">
            <text class="table-title">{{currentDoc.title}}</text>
            <text class="table-info">{{currentDoc.type === 'excel' ? 'Excelè¡¨æ ¼' : 'CSVè¡¨æ ¼'}}</text>
          </view>
          <scroll-view class="table-container" scroll-x="true">
            <view class="table-content" wx:if="{{currentDoc.tableData}}">
              <!-- è¡¨å¤´ -->
              <view class="table-row table-header-row">
                <view class="table-cell table-header-cell" wx:for="{{currentDoc.tableData[0]}}" wx:key="index">
                  <text>{{item}}</text>
                </view>
              </view>
              <!-- æ•°æ®è¡Œ -->
              <view class="table-row" wx:for="{{currentDoc.tableData}}" wx:for-index="rowIndex" wx:for-item="row" wx:key="rowIndex" wx:if="{{rowIndex > 0}}">
                <view class="table-cell {{currentDoc.isEditMode ? 'editable' : ''}}" wx:for="{{row}}" wx:for-index="colIndex" wx:for-item="cell" wx:key="colIndex">
                  <input wx:if="{{currentDoc.isEditMode}}" class="cell-input" value="{{cell}}" data-row="{{rowIndex}}" data-col="{{colIndex}}" bindinput="onCellInput" />
                  <text wx:else>{{cell}}</text>
                </view>
              </view>
            </view>
          </scroll-view>
          <view class="table-footer">
            <text class="table-stats">å…± {{currentDoc.tableData ? currentDoc.tableData.length - 1 : 0}} è¡Œæ•°æ®</text>
            <view class="table-actions">
              <text class="edit-mode-btn" bindtap="toggleEditMode">{{currentDoc.isEditMode ? 'é¢„è§ˆæ¨¡å¼' : 'ç¼–è¾‘æ¨¡å¼'}}</text>
              <text wx:if="{{currentDoc.isEditMode}}" class="table-action-btn" bindtap="addTableRow">+ æ·»åŠ è¡Œ</text>
              <text wx:if="{{currentDoc.isEditMode}}" class="table-action-btn" bindtap="saveTableData">ä¿å­˜è¡¨æ ¼</text>
            </view>
          </view>
        </view>
        <view wx:else class="rich-editor-container">
          <!-- å¯Œæ–‡æœ¬å·¥å…·æ  -->
          <view class="rich-toolbar">
            <view class="toolbar-group">
              <text class="toolbar-btn {{currentDoc.format.bold ? 'active' : ''}}" bindtap="toggleFormat" data-format="bold">B</text>
              <text class="toolbar-btn {{currentDoc.format.italic ? 'active' : ''}}" bindtap="toggleFormat" data-format="italic">I</text>
              <text class="toolbar-btn {{currentDoc.format.underline ? 'active' : ''}}" bindtap="toggleFormat" data-format="underline">U</text>
            </view>
            <view class="toolbar-group">
              <text class="toolbar-btn" bindtap="insertFormat" data-format="h1">H1</text>
              <text class="toolbar-btn" bindtap="insertFormat" data-format="h2">H2</text>
              <text class="toolbar-btn" bindtap="insertFormat" data-format="h3">H3</text>
            </view>
            <view class="toolbar-group">
              <text class="toolbar-btn" bindtap="insertFormat" data-format="list">â€¢</text>
              <text class="toolbar-btn" bindtap="insertFormat" data-format="number">1.</text>
              <text class="toolbar-btn" bindtap="insertFormat" data-format="quote">"</text>
            </view>
            <view class="toolbar-group">
              <text class="toolbar-btn" bindtap="insertFormat" data-format="link">ğŸ”—</text>
              <text class="toolbar-btn" bindtap="insertFormat" data-format="image">ğŸ“·</text>
              <text class="toolbar-btn" bindtap="insertFormat" data-format="table">âŠ</text>
            </view>
          </view>
          
          <!-- å¯Œæ–‡æœ¬ç¼–è¾‘åŒºåŸŸ -->
          <view class="rich-editor-wrapper">
            <textarea class="editor-textarea rich-text" placeholder="å¼€å§‹ç¼–å†™æ‚¨çš„æ–‡æ¡£..." value="{{currentDoc.content}}" bindinput="onContentInput" focus="{{editorFocus}}"></textarea>
            
            <!-- æ ¼å¼é¢„è§ˆåŒºåŸŸ -->
            <view class="format-preview" wx:if="{{currentDoc.showPreview}}">
              <view class="preview-content">
                <rich-text nodes="{{currentDoc.formattedContent}}"></rich-text>
              </view>
            </view>
          </view>
          
          <!-- ç¼–è¾‘æ¨¡å¼åˆ‡æ¢ -->
          <view class="editor-mode-switch">
            <text class="mode-btn {{!currentDoc.showPreview ? 'active' : ''}}" bindtap="switchEditorMode" data-mode="edit">ç¼–è¾‘</text>
            <text class="mode-btn {{currentDoc.showPreview ? 'active' : ''}}" bindtap="switchEditorMode" data-mode="preview">é¢„è§ˆ</text>
          </view>
        </view>
        <textarea wx:if="{{(currentDoc.type === 'excel' || currentDoc.type === 'table') && currentDoc.isEditMode}}" class="editor-textarea table-edit-mode" placeholder="ç¼–è¾‘è¡¨æ ¼æ•°æ®..." value="{{currentDoc.content}}" bindinput="onContentInput"></textarea>
      </view>
      
      <view class="editor-footer">
        <view class="editor-status">
          <text class="word-count">å­—æ•°ï¼š{{currentDoc.wordCount}}</text>
          <text class="save-status {{currentDoc.saveStatus}}">{{currentDoc.saveStatusText}}</text>
        </view>
        <view class="editor-tools">
          <text class="tool-btn" bindtap="insertTemplate" data-template="heading">H</text>
          <text class="tool-btn" bindtap="insertTemplate" data-template="bold">B</text>
          <text class="tool-btn" bindtap="insertTemplate" data-template="italic">I</text>
          <text class="tool-btn" bindtap="insertTemplate" data-template="list">â€¢</text>
          <button class="complete-btn" bindtap="completeEditing">å®Œæˆç¼–è¾‘</button>
        </view>
      </view>
    </view>
  </view>

  <!-- ç¼–è¾‘å†å²å¼¹çª— -->
  <view class="modal-overlay" wx:if="{{showEditHistory}}" bindtap="hideEditHistory">
    <view class="modal-content edit-history-modal" catchtap="preventClose">
      <view class="modal-header">
        <text class="modal-title">ç¼–è¾‘å†å²</text>
        <text class="modal-close" bindtap="hideEditHistory">âœ•</text>
      </view>
      
      <view class="modal-body">
        <view class="edit-history-list" wx:if="{{currentDoc.editHistory && currentDoc.editHistory.length > 0}}">
          <view class="history-item" wx:for="{{currentDoc.editHistory}}" wx:key="id" wx:for-item="record">
            <view class="history-header">
              <view class="user-info">
                <text class="user-name">{{record.userName}}</text>
                <text class="action-type">{{record.action === 'edit' ? 'ç¼–è¾‘äº†æ–‡æ¡£' : 'åˆ›å»ºäº†æ–‡æ¡£'}}</text>
              </view>
              <text class="history-time">{{record.timestamp}}</text>
            </view>
            <view class="history-details" wx:if="{{record.changes}}">
              <text class="change-description">{{record.changes.description}}</text>
              <text class="content-length" wx:if="{{record.contentLength}}">å†…å®¹é•¿åº¦: {{record.contentLength}} å­—ç¬¦</text>
            </view>
          </view>
        </view>
        <view class="empty-history" wx:else>
          <text class="empty-text">æš‚æ— ç¼–è¾‘å†å²</text>
        </view>
      </view>
      
      <view class="modal-footer">
        <button class="btn btn-secondary" bindtap="hideEditHistory">å…³é—­</button>
      </view>
    </view>
  </view>
</view>