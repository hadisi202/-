<!--pages/meeting/meeting.wxml-->
<view class="container">
  <!-- é¡¶éƒ¨ç»Ÿè®¡åŒºåŸŸ -->
  <view class="stats-section">
    <view class="stats-grid">
      <view class="stat-item">
        <text class="stat-number">{{stats.total}}</text>
        <text class="stat-label">æ€»ä¼šè®®</text>
      </view>
      <view class="stat-item">
        <text class="stat-number">{{stats.today}}</text>
        <text class="stat-label">ä»Šæ—¥ä¼šè®®</text>
      </view>
      <view class="stat-item">
        <text class="stat-number">{{stats.upcoming}}</text>
        <text class="stat-label">å³å°†å¼€å§‹</text>
      </view>
      <view class="stat-item">
        <text class="stat-number">{{stats.completed}}</text>
        <text class="stat-label">å·²å®Œæˆ</text>
      </view>
    </view>
  </view>

  <!-- å¿«é€Ÿæ“ä½œ -->
  <view class="quick-actions">
    <view class="action-item" bindtap="createMeeting">
      <view class="action-icon create">ğŸ“…</view>
      <text class="action-text">å®‰æ’ä¼šè®®</text>
    </view>
    <view class="action-item" bindtap="joinMeeting">
      <view class="action-icon join">ğŸ¥</view>
      <text class="action-text">åŠ å…¥ä¼šè®®</text>
    </view>
    <view class="action-item" bindtap="quickMeeting">
      <view class="action-icon quick">âš¡</view>
      <text class="action-text">å¿«é€Ÿä¼šè®®</text>
    </view>
    <view class="action-item" bindtap="showTemplates">
      <view class="action-icon template">ğŸ“‹</view>
      <text class="action-text">ä¼šè®®æ¨¡æ¿</text>
    </view>
  </view>

  <!-- æœç´¢å’Œç­›é€‰åŒºåŸŸ -->
  <view class="search-section">
    <view class="search-bar">
      <input class="search-input" placeholder="æœç´¢ä¼šè®®" value="{{searchText}}" bindinput="onSearchInput" />
      <text class="search-icon">ğŸ”</text>
    </view>
    
    <view class="filter-tabs">
      <view class="filter-tab {{currentFilter === 'all' ? 'active' : ''}}" bindtap="switchFilter" data-filter="all">
        <text>å…¨éƒ¨</text>
      </view>
      <view class="filter-tab {{currentFilter === 'today' ? 'active' : ''}}" bindtap="switchFilter" data-filter="today">
        <text>ä»Šå¤©</text>
      </view>
      <view class="filter-tab {{currentFilter === 'upcoming' ? 'active' : ''}}" bindtap="switchFilter" data-filter="upcoming">
        <text>å³å°†å¼€å§‹</text>
      </view>
      <view class="filter-tab {{currentFilter === 'completed' ? 'active' : ''}}" bindtap="switchFilter" data-filter="completed">
        <text>å·²å®Œæˆ</text>
      </view>
    </view>
    
    <view class="sort-options">
      <view class="sort-item {{currentSort === 'startTime' ? 'active' : ''}}" bindtap="switchSort" data-sort="startTime">
        <text>å¼€å§‹æ—¶é—´</text>
      </view>
      <view class="sort-item {{currentSort === 'createdAt' ? 'active' : ''}}" bindtap="switchSort" data-sort="createdAt">
        <text>åˆ›å»ºæ—¶é—´</text>
      </view>
      <view class="sort-item {{currentSort === 'title' ? 'active' : ''}}" bindtap="switchSort" data-sort="title">
        <text>ä¼šè®®ä¸»é¢˜</text>
      </view>
    </view>
  </view>

  <!-- ä¼šè®®åˆ—è¡¨ -->
  <view class="meetings-list" wx:if="{{filteredMeetings.length > 0}}">
    <view class="meeting-item" wx:for="{{filteredMeetings}}" wx:key="id" bindtap="openMeeting" data-item="{{item}}">
      <!-- ä¼šè®®çŠ¶æ€æŒ‡ç¤ºå™¨ -->
      <view class="meeting-status {{item.status}}">
        <text class="status-dot"></text>
      </view>
      
      <!-- ä¼šè®®ä¿¡æ¯ -->
      <view class="meeting-content">
        <text class="meeting-title">{{item.title}}</text>
        <text class="meeting-desc" wx:if="{{item.description}}">{{item.description}}</text>
        
        <!-- ä¼šè®®æ—¶é—´ -->
        <view class="meeting-time">
          <text class="time-icon">ğŸ•</text>
          <text class="time-text">{{item.timeText}}</text>
          <text class="duration-text" wx:if="{{item.duration}}">{{item.duration}}åˆ†é’Ÿ</text>
        </view>
        
        <!-- ä¼šè®®åœ°ç‚¹/é“¾æ¥ -->
        <view class="meeting-location" wx:if="{{item.location || item.meetingLink}}">
          <text class="location-icon">{{item.meetingLink ? 'ğŸ”—' : 'ğŸ“'}}</text>
          <text class="location-text">{{item.location || 'åœ¨çº¿ä¼šè®®'}}</text>
        </view>
        
        <!-- å‚ä¼šäººå‘˜ -->
        <view class="meeting-attendees" wx:if="{{item.attendees && item.attendees.length > 0}}">
          <text class="attendees-icon">ğŸ‘¥</text>
          <text class="attendees-text">{{item.attendeesText}}</text>
        </view>
        
        <!-- ä¼šè®®æ ‡ç­¾ -->
        <view class="meeting-tags" wx:if="{{item.tags && item.tags.length > 0}}">
          <text class="meeting-tag" wx:for="{{item.tags}}" wx:for-item="tag" wx:key="*this">{{tag}}</text>
        </view>
      </view>
      
      <!-- ä¼šè®®æ“ä½œ -->
      <view class="meeting-actions">
        <!-- å¿«é€Ÿæ“ä½œæŒ‰é’® -->
        <view class="quick-action-btn join" wx:if="{{item.status === 'upcoming' || item.status === 'ongoing'}}" bindtap="joinMeetingById" data-id="{{item.id}}" catchtap="preventBubble">
          <text class="action-icon">ğŸ¥</text>
        </view>
        <view class="quick-action-btn notes" wx:if="{{item.status === 'ongoing' || item.status === 'completed'}}" bindtap="openNotes" data-id="{{item.id}}" catchtap="preventBubble">
          <text class="action-icon">ğŸ“</text>
        </view>
        
        <!-- æ›´å¤šæ“ä½œ -->
        <view class="action-btn" bindtap="showMeetingOptions" data-item="{{item}}" catchtap="preventBubble">
          <text class="action-icon">â‹¯</text>
        </view>
      </view>
    </view>
  </view>

  <!-- ç©ºçŠ¶æ€ -->
  <view class="empty-state" wx:else>
    <text class="empty-icon">ğŸ“…</text>
    <text class="empty-text">{{emptyText}}</text>
    <text class="empty-action" bindtap="createMeeting" wx:if="{{currentFilter === 'all' || currentFilter === 'today'}}">å®‰æ’ç¬¬ä¸€ä¸ªä¼šè®®</text>
  </view>

  <!-- æµ®åŠ¨æ“ä½œæŒ‰é’® -->
  <view class="fab" bindtap="createMeeting">
    <text class="fab-icon">+</text>
  </view>

  <!-- ä¼šè®®åˆ›å»º/ç¼–è¾‘å¼¹çª— -->
  <view class="modal-overlay" wx:if="{{showMeetingModal}}" bindtap="hideMeetingModal">
    <view class="modal-content" catchtap="preventClose">
      <view class="modal-header">
        <text class="modal-title">{{editingMeeting.id ? 'ç¼–è¾‘ä¼šè®®' : 'å®‰æ’ä¼šè®®'}}</text>
        <text class="modal-close" bindtap="hideMeetingModal">âœ•</text>
      </view>
      
      <view class="modal-body">
        <!-- ä¼šè®®ä¸»é¢˜ -->
        <view class="input-group">
          <text class="input-label">ä¼šè®®ä¸»é¢˜ <text class="input-required">*</text></text>
          <input class="input" placeholder="è¯·è¾“å…¥ä¼šè®®ä¸»é¢˜" value="{{editingMeeting.title}}" bindinput="onTitleInput" />
        </view>
        
        <!-- ä¼šè®®æè¿° -->
        <view class="input-group">
          <text class="input-label">ä¼šè®®æè¿°</text>
          <textarea class="input textarea" placeholder="è¯·è¾“å…¥ä¼šè®®æè¿°" value="{{editingMeeting.description}}" bindinput="onDescInput"></textarea>
        </view>
        
        <!-- å¼€å§‹æ—¶é—´ -->
        <view class="input-group">
          <text class="input-label">å¼€å§‹æ—¶é—´ <text class="input-required">*</text></text>
          <view class="datetime-picker">
            <picker mode="date" value="{{editingMeeting.startDate}}" bindchange="onStartDateChange">
              <view class="picker-input">
                <text class="picker-text">{{editingMeeting.startDate || 'é€‰æ‹©æ—¥æœŸ'}}</text>
                <text class="picker-icon">ğŸ“…</text>
              </view>
            </picker>
            <picker mode="time" value="{{editingMeeting.startTime}}" bindchange="onStartTimeChange">
              <view class="picker-input">
                <text class="picker-text">{{editingMeeting.startTime || 'é€‰æ‹©æ—¶é—´'}}</text>
                <text class="picker-icon">ğŸ•</text>
              </view>
            </picker>
          </view>
        </view>
        
        <!-- ä¼šè®®æ—¶é•¿ -->
        <view class="input-group">
          <text class="input-label">ä¼šè®®æ—¶é•¿</text>
          <picker mode="selector" range="{{durationOptions}}" value="{{editingMeeting.durationIndex}}" bindchange="onDurationChange">
            <view class="picker-input">
              <text class="picker-text">{{durationOptions[editingMeeting.durationIndex]}}</text>
              <text class="picker-icon">â±ï¸</text>
            </view>
          </picker>
        </view>
        
        <!-- ä¼šè®®ç±»å‹ -->
        <view class="input-group">
          <text class="input-label">ä¼šè®®ç±»å‹</text>
          <view class="type-selector">
            <view class="type-option {{editingMeeting.type === 'online' ? 'active' : ''}}" bindtap="selectMeetingType" data-type="online">
              <text class="type-icon">ğŸ”—</text>
              <text>åœ¨çº¿ä¼šè®®</text>
            </view>
            <view class="type-option {{editingMeeting.type === 'offline' ? 'active' : ''}}" bindtap="selectMeetingType" data-type="offline">
              <text class="type-icon">ğŸ“</text>
              <text>çº¿ä¸‹ä¼šè®®</text>
            </view>
          </view>
        </view>
        
        <!-- ä¼šè®®åœ°ç‚¹/é“¾æ¥ -->
        <view class="input-group" wx:if="{{editingMeeting.type}}">
          <text class="input-label">{{editingMeeting.type === 'online' ? 'ä¼šè®®é“¾æ¥' : 'ä¼šè®®åœ°ç‚¹'}}</text>
          <input class="input" placeholder="{{editingMeeting.type === 'online' ? 'è¯·è¾“å…¥ä¼šè®®é“¾æ¥' : 'è¯·è¾“å…¥ä¼šè®®åœ°ç‚¹'}}" value="{{editingMeeting.type === 'online' ? editingMeeting.meetingLink : editingMeeting.location}}" bindinput="onLocationInput" />
        </view>
        
        <!-- å‚ä¼šäººå‘˜ -->
        <view class="input-group">
          <text class="input-label">å‚ä¼šäººå‘˜</text>
          <view class="attendees-input-container">
            <view class="selected-attendees" wx:if="{{editingMeeting.attendees && editingMeeting.attendees.length > 0}}">
              <view class="selected-attendee" wx:for="{{editingMeeting.attendees}}" wx:key="*this">
                <text>{{item}}</text>
                <text class="attendee-remove" bindtap="removeAttendee" data-attendee="{{item}}">Ã—</text>
              </view>
            </view>
            <view class="attendee-input-row">
              <input class="attendee-input" placeholder="æ·»åŠ å‚ä¼šäººå‘˜" value="{{inputAttendee}}" bindinput="onAttendeeInput" bindconfirm="addAttendee" />
              <button class="attendee-add-btn" bindtap="addAttendee">æ·»åŠ </button>
            </view>
          </view>
        </view>
        
        <!-- æé†’è®¾ç½® -->
        <view class="input-group">
          <text class="input-label">æé†’è®¾ç½®</text>
          <view class="reminder-options">
            <view class="reminder-option {{editingMeeting.reminderIndex === index ? 'active' : ''}}" wx:for="{{reminderOptions}}" wx:key="*this" bindtap="selectReminder" data-index="{{index}}">
              <text>{{item}}</text>
            </view>
          </view>
        </view>
        
        <!-- æ ‡ç­¾ -->
        <view class="input-group">
          <text class="input-label">æ ‡ç­¾</text>
          <view class="tag-input-container">
            <view class="selected-tags" wx:if="{{editingMeeting.tags && editingMeeting.tags.length > 0}}">
              <view class="selected-tag" wx:for="{{editingMeeting.tags}}" wx:key="*this">
                <text>{{item}}</text>
                <text class="tag-remove" bindtap="removeTag" data-tag="{{item}}">Ã—</text>
              </view>
            </view>
            <view class="tag-input-row">
              <input class="tag-input" placeholder="æ·»åŠ æ ‡ç­¾" value="{{inputTag}}" bindinput="onTagInput" bindconfirm="addTag" />
              <button class="tag-add-btn" bindtap="addTag">æ·»åŠ </button>
            </view>
          </view>
        </view>
      </view>
      
      <view class="modal-footer">
        <button class="btn btn-secondary" bindtap="hideMeetingModal">å–æ¶ˆ</button>
        <button class="btn btn-primary" bindtap="saveMeeting">ä¿å­˜</button>
      </view>
    </view>
  </view>

  <!-- ä¼šè®®æ“ä½œå¼¹çª— -->
  <view class="action-sheet" wx:if="{{showMeetingOptions}}" bindtap="hideMeetingOptions">
    <view class="action-sheet-content" catchtap="preventClose">
      <view class="action-sheet-header">
        <text class="action-sheet-title">{{selectedMeeting.title}}</text>
        <text class="action-sheet-close" bindtap="hideMeetingOptions">âœ•</text>
      </view>
      <view class="action-list">
        <view class="action-item" wx:if="{{selectedMeeting.status === 'upcoming' || selectedMeeting.status === 'ongoing'}}" bindtap="joinSelectedMeeting">
          <text class="action-icon">ğŸ¥</text>
          <text class="action-text">åŠ å…¥ä¼šè®®</text>
        </view>
        <view class="action-item" bindtap="editMeeting">
          <text class="action-icon">âœï¸</text>
          <text class="action-text">ç¼–è¾‘</text>
        </view>
        <view class="action-item" bindtap="duplicateMeeting">
          <text class="action-icon">ğŸ“‹</text>
          <text class="action-text">å¤åˆ¶</text>
        </view>
        <view class="action-item" wx:if="{{selectedMeeting.status === 'ongoing' || selectedMeeting.status === 'completed'}}" bindtap="viewNotes">
          <text class="action-icon">ğŸ“</text>
          <text class="action-text">ä¼šè®®çºªè¦</text>
        </view>
        <view class="action-item" bindtap="shareMeeting">
          <text class="action-icon">ğŸ“¤</text>
          <text class="action-text">åˆ†äº«</text>
        </view>
        <view class="action-item" wx:if="{{selectedMeeting.status === 'upcoming'}}" bindtap="cancelMeeting">
          <text class="action-icon">âŒ</text>
          <text class="action-text">å–æ¶ˆä¼šè®®</text>
        </view>
        <view class="action-item danger" bindtap="deleteMeeting">
          <text class="action-icon">ğŸ—‘ï¸</text>
          <text class="action-text">åˆ é™¤</text>
        </view>
      </view>
      <view class="action-cancel" bindtap="hideMeetingOptions">
        <text>å–æ¶ˆ</text>
      </view>
    </view>
  </view>

  <!-- ä¼šè®®æ¨¡æ¿å¼¹çª— -->
  <view class="modal-overlay" wx:if="{{showTemplates}}" bindtap="hideTemplates">
    <view class="modal-content" catchtap="preventClose">
      <view class="modal-header">
        <text class="modal-title">é€‰æ‹©ä¼šè®®æ¨¡æ¿</text>
        <text class="modal-close" bindtap="hideTemplates">âœ•</text>
      </view>
      
      <view class="modal-body">
        <view class="template-grid">
          <view class="template-item" wx:for="{{meetingTemplates}}" wx:key="id" bindtap="createFromTemplate" data-template="{{item}}">
            <view class="template-icon">
              <text>{{item.icon}}</text>
            </view>
            <text class="template-title">{{item.title}}</text>
            <text class="template-desc">{{item.description}}</text>
            <text class="template-duration">{{item.duration}}åˆ†é’Ÿ</text>
          </view>
        </view>
      </view>
      
      <view class="modal-footer">
        <button class="btn btn-secondary" bindtap="hideTemplates">å–æ¶ˆ</button>
      </view>
    </view>
  </view>

  <!-- ä¼šè®®çºªè¦å¼¹çª— -->
  <view class="modal-overlay notes-modal" wx:if="{{showNotes}}" bindtap="hideNotes">
    <view class="notes-content" catchtap="preventClose">
      <view class="notes-header">
        <text class="notes-title">{{currentMeeting.title}} - ä¼šè®®çºªè¦</text>
        <view class="notes-actions">
          <text class="notes-action" bindtap="saveNotes">ğŸ’¾</text>
          <text class="notes-action" bindtap="hideNotes">âœ•</text>
        </view>
      </view>
      
      <view class="notes-body">
        <textarea class="notes-textarea" placeholder="è®°å½•ä¼šè®®å†…å®¹ã€å†³è®®å’Œåç»­è¡ŒåŠ¨..." value="{{currentMeeting.notes}}" bindinput="onNotesInput"></textarea>
      </view>
      
      <view class="notes-footer">
        <view class="notes-status">
          <text class="word-count">å­—æ•°ï¼š{{currentMeeting.notesWordCount}}</text>
          <text class="save-status {{currentMeeting.notesSaveStatus}}">{{currentMeeting.notesSaveStatusText}}</text>
        </view>
        <view class="notes-tools">
          <text class="tool-btn" bindtap="insertNotesTemplate" data-template="agenda">è®®ç¨‹</text>
          <text class="tool-btn" bindtap="insertNotesTemplate" data-template="decision">å†³è®®</text>
          <text class="tool-btn" bindtap="insertNotesTemplate" data-template="action">è¡ŒåŠ¨</text>
        </view>
      </view>
    </view>
  </view>

  <!-- åŠ å…¥ä¼šè®®å¼¹çª— -->
  <view class="modal-overlay" wx:if="{{showJoinModal}}" bindtap="hideJoinModal">
    <view class="modal-content" catchtap="preventClose">
      <view class="modal-header">
        <text class="modal-title">åŠ å…¥ä¼šè®®</text>
        <text class="modal-close" bindtap="hideJoinModal">âœ•</text>
      </view>
      
      <view class="modal-body">
        <view class="input-group">
          <text class="input-label">ä¼šè®®IDæˆ–é“¾æ¥</text>
          <input class="input" placeholder="è¯·è¾“å…¥ä¼šè®®IDæˆ–ç²˜è´´ä¼šè®®é“¾æ¥" value="{{joinMeetingId}}" bindinput="onJoinMeetingIdInput" />
        </view>
        
        <view class="input-group">
          <text class="input-label">æ‚¨çš„å§“å</text>
          <input class="input" placeholder="è¯·è¾“å…¥æ‚¨çš„å§“å" value="{{joinMeetingName}}" bindinput="onJoinMeetingNameInput" />
        </view>
      </view>
      
      <view class="modal-footer">
        <button class="btn btn-secondary" bindtap="hideJoinModal">å–æ¶ˆ</button>
        <button class="btn btn-primary" bindtap="confirmJoinMeeting">åŠ å…¥ä¼šè®®</button>
      </view>
    </view>
  </view>
</view>