<!--pages/meeting/meeting.wxml-->
<view class="container">
  <!-- 顶部统计区域 -->
  <view class="stats-section">
    <view class="stats-grid">
      <view class="stat-item">
        <text class="stat-number">{{stats.total}}</text>
        <text class="stat-label">总会议</text>
      </view>
      <view class="stat-item">
        <text class="stat-number">{{stats.today}}</text>
        <text class="stat-label">今日会议</text>
      </view>
      <view class="stat-item">
        <text class="stat-number">{{stats.upcoming}}</text>
        <text class="stat-label">即将开始</text>
      </view>
      <view class="stat-item">
        <text class="stat-number">{{stats.completed}}</text>
        <text class="stat-label">已完成</text>
      </view>
    </view>
  </view>

  <!-- 快速操作 -->
  <view class="quick-actions">
    <view class="action-item" bindtap="createMeeting">
      <view class="action-icon create">📅</view>
      <text class="action-text">安排会议</text>
    </view>
    <view class="action-item" bindtap="joinMeeting">
      <view class="action-icon join">🎥</view>
      <text class="action-text">加入会议</text>
    </view>
    <view class="action-item" bindtap="quickMeeting">
      <view class="action-icon quick">⚡</view>
      <text class="action-text">快速会议</text>
    </view>
    <view class="action-item" bindtap="showTemplates">
      <view class="action-icon template">📋</view>
      <text class="action-text">会议模板</text>
    </view>
  </view>

  <!-- 搜索和筛选区域 -->
  <view class="search-section">
    <view class="search-bar">
      <input class="search-input" placeholder="搜索会议" value="{{searchText}}" bindinput="onSearchInput" />
      <text class="search-icon">🔍</text>
    </view>
    
    <view class="filter-tabs">
      <view class="filter-tab {{currentFilter === 'all' ? 'active' : ''}}" bindtap="switchFilter" data-filter="all">
        <text>全部</text>
      </view>
      <view class="filter-tab {{currentFilter === 'today' ? 'active' : ''}}" bindtap="switchFilter" data-filter="today">
        <text>今天</text>
      </view>
      <view class="filter-tab {{currentFilter === 'upcoming' ? 'active' : ''}}" bindtap="switchFilter" data-filter="upcoming">
        <text>即将开始</text>
      </view>
      <view class="filter-tab {{currentFilter === 'completed' ? 'active' : ''}}" bindtap="switchFilter" data-filter="completed">
        <text>已完成</text>
      </view>
    </view>
    
    <view class="sort-options">
      <view class="sort-item {{currentSort === 'startTime' ? 'active' : ''}}" bindtap="switchSort" data-sort="startTime">
        <text>开始时间</text>
      </view>
      <view class="sort-item {{currentSort === 'createdAt' ? 'active' : ''}}" bindtap="switchSort" data-sort="createdAt">
        <text>创建时间</text>
      </view>
      <view class="sort-item {{currentSort === 'title' ? 'active' : ''}}" bindtap="switchSort" data-sort="title">
        <text>会议主题</text>
      </view>
    </view>
  </view>

  <!-- 会议列表 -->
  <view class="meetings-list" wx:if="{{filteredMeetings.length > 0}}">
    <view class="meeting-item" wx:for="{{filteredMeetings}}" wx:key="id" bindtap="openMeeting" data-item="{{item}}">
      <!-- 会议状态指示器 -->
      <view class="meeting-status {{item.status}}">
        <text class="status-dot"></text>
      </view>
      
      <!-- 会议信息 -->
      <view class="meeting-content">
        <text class="meeting-title">{{item.title}}</text>
        <text class="meeting-desc" wx:if="{{item.description}}">{{item.description}}</text>
        
        <!-- 会议时间 -->
        <view class="meeting-time">
          <text class="time-icon">🕐</text>
          <text class="time-text">{{item.timeText}}</text>
          <text class="duration-text" wx:if="{{item.duration}}">{{item.duration}}分钟</text>
        </view>
        
        <!-- 会议地点/链接 -->
        <view class="meeting-location" wx:if="{{item.location || item.meetingLink}}">
          <text class="location-icon">{{item.meetingLink ? '🔗' : '📍'}}</text>
          <text class="location-text">{{item.location || '在线会议'}}</text>
        </view>
        
        <!-- 参会人员 -->
        <view class="meeting-attendees" wx:if="{{item.attendees && item.attendees.length > 0}}">
          <text class="attendees-icon">👥</text>
          <text class="attendees-text">{{item.attendeesText}}</text>
        </view>
        
        <!-- 会议标签 -->
        <view class="meeting-tags" wx:if="{{item.tags && item.tags.length > 0}}">
          <text class="meeting-tag" wx:for="{{item.tags}}" wx:for-item="tag" wx:key="*this">{{tag}}</text>
        </view>
      </view>
      
      <!-- 会议操作 -->
      <view class="meeting-actions">
        <!-- 快速操作按钮 -->
        <view class="quick-action-btn join" wx:if="{{item.status === 'upcoming' || item.status === 'ongoing'}}" bindtap="joinMeetingById" data-id="{{item.id}}" catchtap="preventBubble">
          <text class="action-icon">🎥</text>
        </view>
        <view class="quick-action-btn notes" wx:if="{{item.status === 'ongoing' || item.status === 'completed'}}" bindtap="openNotes" data-id="{{item.id}}" catchtap="preventBubble">
          <text class="action-icon">📝</text>
        </view>
        
        <!-- 更多操作 -->
        <view class="action-btn" bindtap="showMeetingOptions" data-item="{{item}}" catchtap="preventBubble">
          <text class="action-icon">⋯</text>
        </view>
      </view>
    </view>
  </view>

  <!-- 空状态 -->
  <view class="empty-state" wx:else>
    <text class="empty-icon">📅</text>
    <text class="empty-text">{{emptyText}}</text>
    <text class="empty-action" bindtap="createMeeting" wx:if="{{currentFilter === 'all' || currentFilter === 'today'}}">安排第一个会议</text>
  </view>

  <!-- 浮动操作按钮 -->
  <view class="fab" bindtap="createMeeting">
    <text class="fab-icon">+</text>
  </view>

  <!-- 会议创建/编辑弹窗 -->
  <view class="modal-overlay" wx:if="{{showMeetingModal}}" bindtap="hideMeetingModal">
    <view class="modal-content" catchtap="preventClose">
      <view class="modal-header">
        <text class="modal-title">{{editingMeeting.id ? '编辑会议' : '安排会议'}}</text>
        <text class="modal-close" bindtap="hideMeetingModal">✕</text>
      </view>
      
      <view class="modal-body">
        <!-- 会议主题 -->
        <view class="input-group">
          <text class="input-label">会议主题 <text class="input-required">*</text></text>
          <input class="input" placeholder="请输入会议主题" value="{{editingMeeting.title}}" bindinput="onTitleInput" />
        </view>
        
        <!-- 会议描述 -->
        <view class="input-group">
          <text class="input-label">会议描述</text>
          <textarea class="input textarea" placeholder="请输入会议描述" value="{{editingMeeting.description}}" bindinput="onDescInput"></textarea>
        </view>
        
        <!-- 开始时间 -->
        <view class="input-group">
          <text class="input-label">开始时间 <text class="input-required">*</text></text>
          <view class="datetime-picker">
            <picker mode="date" value="{{editingMeeting.startDate}}" bindchange="onStartDateChange">
              <view class="picker-input">
                <text class="picker-text">{{editingMeeting.startDate || '选择日期'}}</text>
                <text class="picker-icon">📅</text>
              </view>
            </picker>
            <picker mode="time" value="{{editingMeeting.startTime}}" bindchange="onStartTimeChange">
              <view class="picker-input">
                <text class="picker-text">{{editingMeeting.startTime || '选择时间'}}</text>
                <text class="picker-icon">🕐</text>
              </view>
            </picker>
          </view>
        </view>
        
        <!-- 会议时长 -->
        <view class="input-group">
          <text class="input-label">会议时长</text>
          <picker mode="selector" range="{{durationOptions}}" value="{{editingMeeting.durationIndex}}" bindchange="onDurationChange">
            <view class="picker-input">
              <text class="picker-text">{{durationOptions[editingMeeting.durationIndex]}}</text>
              <text class="picker-icon">⏱️</text>
            </view>
          </picker>
        </view>
        
        <!-- 会议类型 -->
        <view class="input-group">
          <text class="input-label">会议类型</text>
          <view class="type-selector">
            <view class="type-option {{editingMeeting.type === 'online' ? 'active' : ''}}" bindtap="selectMeetingType" data-type="online">
              <text class="type-icon">🔗</text>
              <text>在线会议</text>
            </view>
            <view class="type-option {{editingMeeting.type === 'offline' ? 'active' : ''}}" bindtap="selectMeetingType" data-type="offline">
              <text class="type-icon">📍</text>
              <text>线下会议</text>
            </view>
          </view>
        </view>
        
        <!-- 会议地点/链接 -->
        <view class="input-group" wx:if="{{editingMeeting.type}}">
          <text class="input-label">{{editingMeeting.type === 'online' ? '会议链接' : '会议地点'}}</text>
          <input class="input" placeholder="{{editingMeeting.type === 'online' ? '请输入会议链接' : '请输入会议地点'}}" value="{{editingMeeting.type === 'online' ? editingMeeting.meetingLink : editingMeeting.location}}" bindinput="onLocationInput" />
        </view>
        
        <!-- 参会人员 -->
        <view class="input-group">
          <text class="input-label">参会人员</text>
          <view class="attendees-input-container">
            <view class="selected-attendees" wx:if="{{editingMeeting.attendees && editingMeeting.attendees.length > 0}}">
              <view class="selected-attendee" wx:for="{{editingMeeting.attendees}}" wx:key="*this">
                <text>{{item}}</text>
                <text class="attendee-remove" bindtap="removeAttendee" data-attendee="{{item}}">×</text>
              </view>
            </view>
            <view class="attendee-input-row">
              <input class="attendee-input" placeholder="添加参会人员" value="{{inputAttendee}}" bindinput="onAttendeeInput" bindconfirm="addAttendee" />
              <button class="attendee-add-btn" bindtap="addAttendee">添加</button>
            </view>
          </view>
        </view>
        
        <!-- 提醒设置 -->
        <view class="input-group">
          <text class="input-label">提醒设置</text>
          <view class="reminder-options">
            <view class="reminder-option {{editingMeeting.reminderIndex === index ? 'active' : ''}}" wx:for="{{reminderOptions}}" wx:key="*this" bindtap="selectReminder" data-index="{{index}}">
              <text>{{item}}</text>
            </view>
          </view>
        </view>
        
        <!-- 标签 -->
        <view class="input-group">
          <text class="input-label">标签</text>
          <view class="tag-input-container">
            <view class="selected-tags" wx:if="{{editingMeeting.tags && editingMeeting.tags.length > 0}}">
              <view class="selected-tag" wx:for="{{editingMeeting.tags}}" wx:key="*this">
                <text>{{item}}</text>
                <text class="tag-remove" bindtap="removeTag" data-tag="{{item}}">×</text>
              </view>
            </view>
            <view class="tag-input-row">
              <input class="tag-input" placeholder="添加标签" value="{{inputTag}}" bindinput="onTagInput" bindconfirm="addTag" />
              <button class="tag-add-btn" bindtap="addTag">添加</button>
            </view>
          </view>
        </view>
      </view>
      
      <view class="modal-footer">
        <button class="btn btn-secondary" bindtap="hideMeetingModal">取消</button>
        <button class="btn btn-primary" bindtap="saveMeeting">保存</button>
      </view>
    </view>
  </view>

  <!-- 会议操作弹窗 -->
  <view class="action-sheet" wx:if="{{showMeetingOptions}}" bindtap="hideMeetingOptions">
    <view class="action-sheet-content" catchtap="preventClose">
      <view class="action-sheet-header">
        <text class="action-sheet-title">{{selectedMeeting.title}}</text>
        <text class="action-sheet-close" bindtap="hideMeetingOptions">✕</text>
      </view>
      <view class="action-list">
        <view class="action-item" wx:if="{{selectedMeeting.status === 'upcoming' || selectedMeeting.status === 'ongoing'}}" bindtap="joinSelectedMeeting">
          <text class="action-icon">🎥</text>
          <text class="action-text">加入会议</text>
        </view>
        <view class="action-item" bindtap="editMeeting">
          <text class="action-icon">✏️</text>
          <text class="action-text">编辑</text>
        </view>
        <view class="action-item" bindtap="duplicateMeeting">
          <text class="action-icon">📋</text>
          <text class="action-text">复制</text>
        </view>
        <view class="action-item" wx:if="{{selectedMeeting.status === 'ongoing' || selectedMeeting.status === 'completed'}}" bindtap="viewNotes">
          <text class="action-icon">📝</text>
          <text class="action-text">会议纪要</text>
        </view>
        <view class="action-item" bindtap="shareMeeting">
          <text class="action-icon">📤</text>
          <text class="action-text">分享</text>
        </view>
        <view class="action-item" wx:if="{{selectedMeeting.status === 'upcoming'}}" bindtap="cancelMeeting">
          <text class="action-icon">❌</text>
          <text class="action-text">取消会议</text>
        </view>
        <view class="action-item danger" bindtap="deleteMeeting">
          <text class="action-icon">🗑️</text>
          <text class="action-text">删除</text>
        </view>
      </view>
      <view class="action-cancel" bindtap="hideMeetingOptions">
        <text>取消</text>
      </view>
    </view>
  </view>

  <!-- 会议模板弹窗 -->
  <view class="modal-overlay" wx:if="{{showTemplates}}" bindtap="hideTemplates">
    <view class="modal-content" catchtap="preventClose">
      <view class="modal-header">
        <text class="modal-title">选择会议模板</text>
        <text class="modal-close" bindtap="hideTemplates">✕</text>
      </view>
      
      <view class="modal-body">
        <view class="template-grid">
          <view class="template-item" wx:for="{{meetingTemplates}}" wx:key="id" bindtap="createFromTemplate" data-template="{{item}}">
            <view class="template-icon">
              <text>{{item.icon}}</text>
            </view>
            <text class="template-title">{{item.title}}</text>
            <text class="template-desc">{{item.description}}</text>
            <text class="template-duration">{{item.duration}}分钟</text>
          </view>
        </view>
      </view>
      
      <view class="modal-footer">
        <button class="btn btn-secondary" bindtap="hideTemplates">取消</button>
      </view>
    </view>
  </view>

  <!-- 会议纪要弹窗 -->
  <view class="modal-overlay notes-modal" wx:if="{{showNotes}}" bindtap="hideNotes">
    <view class="notes-content" catchtap="preventClose">
      <view class="notes-header">
        <text class="notes-title">{{currentMeeting.title}} - 会议纪要</text>
        <view class="notes-actions">
          <text class="notes-action" bindtap="saveNotes">💾</text>
          <text class="notes-action" bindtap="hideNotes">✕</text>
        </view>
      </view>
      
      <view class="notes-body">
        <textarea class="notes-textarea" placeholder="记录会议内容、决议和后续行动..." value="{{currentMeeting.notes}}" bindinput="onNotesInput"></textarea>
      </view>
      
      <view class="notes-footer">
        <view class="notes-status">
          <text class="word-count">字数：{{currentMeeting.notesWordCount}}</text>
          <text class="save-status {{currentMeeting.notesSaveStatus}}">{{currentMeeting.notesSaveStatusText}}</text>
        </view>
        <view class="notes-tools">
          <text class="tool-btn" bindtap="insertNotesTemplate" data-template="agenda">议程</text>
          <text class="tool-btn" bindtap="insertNotesTemplate" data-template="decision">决议</text>
          <text class="tool-btn" bindtap="insertNotesTemplate" data-template="action">行动</text>
        </view>
      </view>
    </view>
  </view>

  <!-- 加入会议弹窗 -->
  <view class="modal-overlay" wx:if="{{showJoinModal}}" bindtap="hideJoinModal">
    <view class="modal-content" catchtap="preventClose">
      <view class="modal-header">
        <text class="modal-title">加入会议</text>
        <text class="modal-close" bindtap="hideJoinModal">✕</text>
      </view>
      
      <view class="modal-body">
        <view class="input-group">
          <text class="input-label">会议ID或链接</text>
          <input class="input" placeholder="请输入会议ID或粘贴会议链接" value="{{joinMeetingId}}" bindinput="onJoinMeetingIdInput" />
        </view>
        
        <view class="input-group">
          <text class="input-label">您的姓名</text>
          <input class="input" placeholder="请输入您的姓名" value="{{joinMeetingName}}" bindinput="onJoinMeetingNameInput" />
        </view>
      </view>
      
      <view class="modal-footer">
        <button class="btn btn-secondary" bindtap="hideJoinModal">取消</button>
        <button class="btn btn-primary" bindtap="confirmJoinMeeting">加入会议</button>
      </view>
    </view>
  </view>
</view>