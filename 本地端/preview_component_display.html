<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>板件查询显示效果 - 修改后</title>
    <style>
        body { 
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'PingFang SC', 'Hiragino Sans GB', 'Microsoft YaHei', sans-serif; 
            margin: 0; 
            padding: 16px; 
            background: #f5f5f5; 
            line-height: 1.4;
        }
        .container { max-width: 400px; margin: 0 auto; }
        .header { margin-bottom: 16px; text-align: center; }
        .title { font-size: 18px; font-weight: 600; color: #333; }
        .subtitle { color: #666; margin-top: 4px; font-size: 14px; }
        .search-box { background: #fff; padding: 12px; border-radius: 8px; box-shadow: 0 2px 6px rgba(0,0,0,0.06); margin-bottom: 16px; }
        .code-input { width: 100%; border: 1px solid #eee; padding: 10px; border-radius: 6px; box-sizing: border-box; font-size: 16px; }
        .actions { display: flex; gap: 12px; margin-top: 12px; }
        .btn { flex: 1; padding: 10px; border: none; border-radius: 6px; cursor: pointer; font-size: 14px; }
        .btn.scan { background: #28a745; color: white; }
        .btn.search { background: #007bff; color: white; }
        .result { margin-top: 16px; }
        .result-type { font-size: 16px; font-weight: 500; margin-bottom: 8px; color: #333; }
        .card { background: #fff; padding: 12px; border-radius: 8px; box-shadow: 0 2px 6px rgba(0,0,0,0.06); }
        .row { display: flex; justify-content: space-between; padding: 8px 0; border-bottom: 1px dashed #f0f0f0; align-items: flex-start; }
        .row:last-child { border-bottom: none; }
        .label { color: #666; font-size: 14px; min-width: 80px; }
        .value { font-weight: 500; word-break: break-all; text-align: right; flex: 1; margin-left: 12px; font-size: 14px; }
        .section-title { 
            font-size: 14px; 
            font-weight: 600; 
            color: #333; 
            margin: 12px 0 8px 0; 
            padding-bottom: 4px; 
            border-bottom: 2px solid #007aff; 
            background: #f8f9fa;
            padding: 8px 12px 4px 12px;
            margin: 12px -12px 8px -12px;
            border-radius: 4px 4px 0 0;
        }
        .highlight { background: #fff3cd; padding: 2px 6px; border-radius: 4px; color: #856404; font-weight: 600; }
        .status { padding: 2px 8px; border-radius: 12px; font-size: 12px; }
        .status.pending { background: #ffeaa7; color: #d63031; }
        .status.completed { background: #d1f2eb; color: #00b894; }
        .comparison { margin-top: 20px; padding: 16px; background: #e8f4fd; border-radius: 8px; border-left: 4px solid #007bff; }
        .comparison h3 { margin: 0 0 12px 0; color: #007bff; font-size: 16px; }
        .comparison ul { margin: 0; padding-left: 20px; }
        .comparison li { margin-bottom: 8px; color: #333; }
        .new-feature { color: #28a745; font-weight: 600; }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <div class="title">打包系统查询</div>
            <div class="subtitle">支持扫码或输入编码查询板件/包裹/托盘</div>
        </div>

        <div class="search-box">
            <input class="code-input" placeholder="请输入编码或扫码" value="2507865594654Q" readonly />
            <div class="actions">
                <button class="btn scan">扫码查询</button>
                <button class="btn search" onclick="loadData()">编码查询</button>
            </div>
        </div>

        <div class="result">
            <div class="result-type">类型：板件</div>
            <div class="card">
                <!-- 基本信息 -->
                <div class="section-title">基本信息</div>
                <div class="row"><span class="label">板件编码</span><span class="value">2507865594654Q</span></div>
                <div class="row"><span class="label">订单号</span><span class="value">HDS20250129</span></div>
                <div class="row"><span class="label">客户地址</span><span class="value">安海</span></div>
                <div class="row"><span class="label">板件名称</span><span class="value">顶板</span></div>
                <div class="row"><span class="label">材质</span><span class="value">爱格安哥拉灰U705ST9双面三胺颗粒板18厘2800*2070</span></div>
                <div class="row"><span class="label">尺寸</span><span class="value">400 X 138 X 18</span></div>
                <div class="row"><span class="label">房间号</span><span class="value">006主卧窗边柜</span></div>
                <div class="row"><span class="label">柜号</span><span class="value">3号柜</span></div>
                
                <!-- 包装信息 -->
                <div class="section-title">包装信息</div>
                <div class="row"><span class="label">所在包裹</span><span class="value">202509290007</span></div>
                <div class="row"><span class="label">第几个包裹</span><span class="value highlight">第3个包裹</span></div>
                <div class="row"><span class="label">所在托盘</span><span class="value">T202509300002</span></div>
                <div class="row"><span class="label">第几个托盘</span><span class="value highlight">第2个托盘</span></div>
                
                <!-- 其他信息 -->
                <div class="section-title">其他信息</div>
                <div class="row"><span class="label">状态</span><span class="value"><span class="status pending">待处理</span></span></div>
                <div class="row"><span class="label">创建时间</span><span class="value">2025-09-27 02:23:33</span></div>
                <div class="row"><span class="label">扫描时间</span><span class="value">2025-09-29 14:55:58</span></div>
            </div>
        </div>

        <div class="comparison">
            <h3>🔧 问题修复说明</h3>
            <ul>
                <li><span class="new-feature">✅ 问题：</span>微信小程序中包裹序号和托盘序号不显示</li>
                <li><span class="new-feature">✅ 原因：</span>条件判断 <code>wx:if="{{result.package.package_index}}"</code> 在 <code>result.package</code> 为空时会报错</li>
                <li><span class="new-feature">✅ 解决方案：</span>修改为 <code>wx:if="{{result.package && result.package.package_index}}"</code></li>
                <li><span class="new-feature">✅ 修复后效果：</span>现在可以正确显示"第3个包裹"和"第2个托盘"信息</li>
            </ul>
        </div>

        <div class="comparison">
            <h3>🎉 修改内容总结</h3>
            <ul>
                <li><span class="new-feature">✅ 新增信息分组</span>：基本信息、包装信息、其他信息</li>
                <li><span class="new-feature">✅ 新增包裹序号</span>：显示"第几个包裹"</li>
                <li><span class="new-feature">✅ 新增托盘序号</span>：显示"第几个托盘"</li>
                <li><span class="new-feature">✅ 优化信息排序</span>：按重要性重新排列字段</li>
                <li><span class="new-feature">✅ 改进视觉效果</span>：添加分组标题和样式</li>
            </ul>
        </div>
    </div>

    <style>
      /* 新增：包装界面改版预览样式 */
      .ui-preview { max-width: 820px; margin: 24px auto; background: #fff; border-radius: 10px; box-shadow: 0 6px 20px rgba(0,0,0,0.06); padding: 16px; }
      .ui-preview .title { font-size: 16px; font-weight: 700; color: #222; margin-bottom: 12px; }
      .grid { display: grid; grid-template-columns: 1fr 1fr 1fr; gap: 12px; }
      .control { display: flex; flex-direction: column; gap: 6px; }
      .control label { font-size: 13px; color: #555; }
      .control select { padding: 8px; border: 1px solid #e5e5e5; border-radius: 6px; background: #fafafa; font-size: 14px; }
      .btnbar { display: flex; gap: 8px; margin-top: 12px; flex-wrap: wrap; }
      .btnbar .btn { padding: 8px 12px; border: none; border-radius: 6px; cursor: pointer; font-size: 13px; }
      .btn.primary { background: #005bbb; color: #fff; }
      .btn.success { background: #28a745; color: #fff; }
      .btn.warn { background: #e67e22; color: #fff; }
      .btn.danger { background: #c0392b; color: #fff; }
      .status-bar { margin-top: 12px; padding: 10px; border-radius: 8px; background: #f0f7ff; color: #005bbb; font-weight: 700; }
      .status-bar.ok { background: #f3e9ff; color: #8e44ad; }
      .status-bar.warn { background: #fff6e9; color: #e67e22; }
      .status-bar.error { background: #ffecec; color: #c0392b; }
      .table-preview { margin-top: 12px; border: 1px dashed #e0e0e0; border-radius: 8px; padding: 8px; }
      .table-preview .thead, .table-preview .row { display: grid; grid-template-columns: 80px 120px 100px 140px 140px 120px 100px 80px; gap: 8px; }
      .table-preview .thead { font-weight: 700; color: #333; padding-bottom: 6px; border-bottom: 2px solid #f0f0f0; }
      .table-preview .row { padding: 6px 0; border-bottom: 1px dashed #f0f0f0; }
    </style>

    <div class="ui-preview">
      <div class="title">包装界面改版预览</div>
      <div class="grid">
        <div class="control">
          <label>订单选择</label>
          <select>
            <option>HDS20250129（安海）</option>
            <option>HDS20250208（厦门）</option>
          </select>
        </div>
        <div class="control">
          <label>验证模式</label>
          <select>
            <option>严格</option>
            <option>宽松</option>
          </select>
        </div>
        <div class="control">
          <label>打包方式</label>
          <select>
            <option>按房间分组</option>
            <option>按柜号分组</option>
            <option selected>混合打包</option>
          </select>
        </div>
      </div>

      <div class="btnbar">
        <button class="btn primary">全选</button>
        <button class="btn">取消全选</button>
        <button class="btn success">一键打包选中项</button>
        <button class="btn warn">删除选中板件</button>
        <button class="btn danger">关闭</button>
      </div>

      <div class="status-bar">状态: 已切换订单，请选择包裹</div>

      <div class="table-preview">
        <div class="thead">
          <div>编号</div><div>名称</div><div>材质</div><div>尺寸</div><div>房间号</div><div>柜号</div><div>状态</div><div>操作</div>
        </div>
        <div class="row">
          <div>2507865594654Q</div><div>顶板</div><div>爱格安哥拉灰…</div><div>400x138x18</div><div>006主卧</div><div>3号柜</div><div>pending</div><div><button class="btn warn">移除</button></div>
        </div>
        <div class="row">
          <div>2507865594655Q</div><div>侧板</div><div>爱格安哥拉灰…</div><div>500x138x18</div><div>006主卧</div><div>3号柜</div><div>pending</div><div><button class="btn warn">移除</button></div>
        </div>
      </div>

      <div class="btnbar">
        <button class="btn" onclick="loadData()">测试 API (http://localhost:5000)</button>
        <button class="btn ok" onclick="document.querySelector('.status-bar').className='status-bar ok';document.querySelector('.status-bar').textContent='状态: 包装已完成';">模拟完成</button>
        <button class="btn warn" onclick="document.querySelector('.status-bar').className='status-bar warn';document.querySelector('.status-bar').textContent='状态: 完整性检查未通过';">模拟警告</button>
        <button class="btn danger" onclick="document.querySelector('.status-bar').className='status-bar error';document.querySelector('.status-bar').textContent='状态: 包装为空，无法完成';">模拟错误</button>
      </div>
    </div>

    <script>
        function loadData() {
            fetch('http://localhost:5000/api/search?code=2507865594654Q')
                .then(response => response.json())
                .then(data => {
                    console.log('API返回数据:', data);
                    alert('✅ API调用成功！\n\n包裹序号: ' + data.package.package_index + '\n托盘序号: ' + data.pallet.pallet_index + '\n\n请查看控制台获取完整数据');
                })
                .catch(error => {
                    console.error('API调用失败:', error);
                    alert('❌ API调用失败，但预览数据正常显示');
                });
        }

        // 页面加载时自动测试API
        window.addEventListener('load', () => {
            console.log('页面加载完成，可以点击"编码查询"按钮测试API');
        });
    </script>
</body>
</html>