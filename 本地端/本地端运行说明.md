# 本地端运行说明

安装依赖：
- 请确保已安装 Python 3.10+（Windows 可从 python.org 下载）
- 进入 e:\Trae\021\本地端 目录，执行：
  pip install -r requirements.txt

运行：
- 双击或运行 python main.py 启动 GUI
- 可选：实时云同步服务会在程序中自动启动，如需命令行手动运行：
  python real_time_cloud_sync.py --recent-once
  python real_time_cloud_sync.py --full-once

日志：
- 同步与请求日志写入 e:\Trae\021\本地端\cloud_sync.log
- 日志超过 5MB 时自动滚动备份为 cloud_sync.log.bak

云端同步多端并发影响与优化：
- 已增加进程级互斥锁（sync.lock），避免同一台机器同时启动多个同步服务造成并发冲突
- HTTP 推送失败带指数退避的自动重试；CLI 兜底模式下自动缩小分片尺寸并分批推送
- 自定义模板回退：若 templates/1.json 不存在，将自动从 custom_templates 选择第一个模板使用

环境变量（HTTP 模式推荐）：
- PACKOPS_BASE_URL: 云函数网关地址（例如 https://xxx.example.com/packOps）
- PACKOPS_API_KEY: 访问密钥
- PACKOPS_VERIFY: 是否校验证书（true/false）
- PACKOPS_ENV_ID: CLI 兜底使用的环境 ID，默认 cloud1-7grjr7usb5d86f59

资源：
- ico10.ico（应用图标）位于 本地端
- custom_templates（自定义模板目录）位于 本地端

- 启动 API 服务：
  - python api_server.py
  - 默认在本地端口启动（如需调整，修改 api_server.py 内相关配置）
- 一键启动脚本：
  - 双击 start.bat 或在终端运行 start.bat
- 同步命令（示例）：
  - 最近一次同步：python real_time_cloud_sync.py --recent-once
  - 全量一次同步：python real_time_cloud_sync.py --full-once
  - 推送到云端：python cloud_sync_to_cloud.py

日志与排错：
- 同步日志文件：e:\Trae\021\本地端\cloud_sync.log（如未生成，请检查路径与脚本权限）
- 常见问题：
  - 未配置 PACKOPS_API_KEY 或 BASE_URL：请在系统环境或 JSON 配置补充后重试
  - CloudBase CLI 未安装/不可用：改用 HTTP PACKOPS_BASE_URL 或安装 CLI
  - 数据库锁：确保没有其他程序占用数据库文件；必要时关闭占用进程

注意事项：
- 移动后已停用原 api_server.py 运行，避免文件占用。
- 若你在 XCX 目录下还需要访问这些本地端脚本，请更新引用路径。

更新与维护：
- 所有改动请在 Git 中跟踪；建议在提交前运行基本功能验证（启动 API、执行一次同步、打开预览页面）。