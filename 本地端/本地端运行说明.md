# 本地端运行说明（021项目）

概述：
- 本地端目录 e:\Trae\021\本地端 已包含运行本地工具所需的全部脚本、配置与数据文件。
- 主要用途：数据同步（本地⇄云端）、订单与托盘管理、标签打印、组件预览、语音辅助等。

目录结构：
- 主程序入口：main.py、api_server.py
- 同步相关：cloud_sync.py、real_time_cloud_sync.py、cloud_sync_to_cloud.py
- 数据库模块：database.py、cloud_enabled_database.py、cloud_database_manager.py
- 管理模块：order_management.py、order_manager.py、pallet_management.py、report_generator.py
- 工具模块：error_handling.py、status_utils.py、qr_handler.py、voice.py
- 配置与脚本：requirements.txt、start.bat、qr_settings.json、invoke_packops.*（含 JSON 配置与 JS/BAT 脚本）
- 模板：templates（包含 包装标签.json、包裹标签.json、托盘标签.json），custom_templates（自定义模板）
- 静态页面：preview_component_display.html
- 资源：ico10.ico（应用图标）
- 数据文件：packaging.db、packing_system.db、packing_system_test.db
- 订单数据：orders/orders_index.json

环境准备：
1) 安装 Python 3.11+（或与你现有环境匹配的版本）。
2) 安装依赖：
   - 进入目录：e:\Trae\021\本地端
   - 执行：pip install -r requirements.txt
3) 如需调用云端或 PackOps：
   - 配置环境变量 PACKOPS_API_KEY、PACKOPS_BASE_URL、ENV_ID（如使用）
   - 或在 invoke_packops_* JSON 中填入相应配置

运行方式：
- 启动 API 服务：
  - python api_server.py
  - 默认在本地端口启动（如需调整，修改 api_server.py 内相关配置）
- 一键启动脚本：
  - 双击 start.bat 或在终端运行 start.bat
- 同步命令（示例）：
  - 最近一次同步：python real_time_cloud_sync.py --recent-once
  - 全量一次同步：python real_time_cloud_sync.py --full-once
  - 推送到云端：python cloud_sync_to_cloud.py

日志与排错：
- 同步日志文件：e:\Trae\021\cloud_sync.log（如未生成，请检查路径与脚本权限）
- 常见问题：
  - 未配置 PACKOPS_API_KEY 或 BASE_URL：请在系统环境或 JSON 配置补充后重试
  - CloudBase CLI 未安装/不可用：改用 HTTP PACKOPS_BASE_URL 或安装 CLI
  - 数据库锁：确保没有其他程序占用数据库文件；必要时关闭占用进程

注意事项：
- 移动后已停用原 api_server.py 运行，避免文件占用。
- 若你在 XCX 目录下还需要访问这些本地端脚本，请更新引用路径。

更新与维护：
- 所有改动请在 Git 中跟踪；建议在提交前运行基本功能验证（启动 API、执行一次同步、打开预览页面）。